#----------------------------------------------------------------------
# Makefile for SVGAlib demo programs.
#
# This file is a part of SVGAlib.
#----------------------------------------------------------------------

include ../Makefile.cfg

srcdir    = ..
VPATH     = $(srcdir)/demos

#----------------------------------------------------------------------
# Compiler Section (overrides Makefile.cfg)
#----------------------------------------------------------------------

CFLAGS = $(WARN) $(OPTIMIZE) -I$(srcdir)/include -I$(srcdir)/gl $(DEBFLAGS) -m32
ifeq (a.out, $(TARGET_FORMAT))
  CFLAGS += -DSVGA_AOUT
endif

#----------------------------------------------------------------------
# Rules Section
#----------------------------------------------------------------------

PROGS    = fun testgl speedtest mousetest vgatest scrolltest testlinear \
	   keytest testaccel accel forktest eventtest spin bg_test printftest \
	   joytest mjoytest bankspeed lineart linearspeed addmodetest \
	   svidtune linearfork cursor vgatweak buildcsr

# Determine what library (static or shared) we will be linking programs with
#ifdef INSTALLSHAREDLIB
#  LIBS = -lvgagl -lvga
#endif
#ifndef LIBS
  LIBS    = ../staticlib/libvgagl.a ../staticlib/libvga.a -lm
  LVGADEP = $(LIBS)
#endif

all:	$(PROGS) graphics

.PHONY: all clean cleanbin dep

$(PROGS): $(LVGADEP)

.c:
	$(CC) $(CFLAGS) $(LDFLAGS) -o $* $*.c $(LIBS) -L$(srcdir)/sharedlib
	$(INSTALL_PROGRAM) $* $(docdir)/demos

rwpage: rwpage.pp
	$(PC) -m32 -Rintel rwpage.pp

testaccel: testaccel.c
	$(CC) $(CFLAGS) $(LDFLAGS) -o testaccel testaccel.c $(LIBS) -lm -L$(srcdir)/sharedlib
	$(INSTALL_PROGRAM) testaccel $(docdir)/demos

accel: accel.c
	$(CC) $(CFLAGS) $(LDFLAGS) -o accel accel.c $(LIBS) -lm -L$(srcdir)/sharedlib
	$(INSTALL_PROGRAM) accel $(docdir)/demos

linearspeed: linearspeed.c memset.o
	$(CC) $(CFLAGS) $(LDFLAGS) -o linearspeed linearspeed.c memset.o $(LIBS) -L$(srcdir)/sharedlib
	$(INSTALL_PROGRAM) linearspeed $(docdir)/demos

buildcsr: mkcur.o
	$(CC) -m32 -o buildcsr $(LDFLAGS) mkcur.o -lvgagl -lvga -L$(srcdir)/sharedlib
	$(INSTALL_PROGRAM) buildcsr $(docdir)/demos

graphics:
	$(INSTALL_DATA) linuxlogo.bitmap eightbpp.xbm clut.xbm sixbpp.xbm \
	wizard.xbm wizardmsk.xbm rwpage.pp $(docdir)/demos

clean:	cleanbin
	rm -f .depend *.o *~ *.bak core

cleanbin:
	rm -f $(PROGS) rwpage

#
# No dependencies required here.
#

dep:
.depend:

